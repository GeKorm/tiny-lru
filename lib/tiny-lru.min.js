/* 2018 Jason Mulligan <jason.mulligan@avoidwork.com> */

"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(a){function b(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return new LRU(a,b,c,d)}var c="undefined"!=typeof process?process.nextTick:function(a){return setTimeout(a,1)},d="",LRU=function(){function LRU(a,b,c,d){return _classCallCheck(this,LRU),this.expire=d,this.max=a,this.notify=b,this.ttl=c,this.reset()}return _createClass(LRU,[{key:"clear",value:function(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.reset(),!a&&this.notify&&c(this.onchange("clear",this.dump())),this}},{key:"clearTimer",value:function(a){return this.has(a,"timers")&&(clearTimeout(this.timers[a]),delete this.timers[a]),this}},{key:"delete",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.remove(a,b)}},{key:"dump",value:function(){var a=JSON.parse(JSON.stringify(this));return delete a.timers,JSON.stringify(a)}},{key:"evict",value:function(){return this.has(this.last)&&this.remove(this.last,!0),this.notify&&c(this.onchange("evict",this.dump())),this}},{key:"get",value:function(a){var b=void 0;return this.has(a)&&(b=this.cache[a].value,this.set(a,b),this.notify&&c(this.onchange("get",this.dump())),this.ttl>0&&this.clearTimer(a).setTimer(a)),b}},{key:"has",value:function(a){return a in this[arguments.length>1&&void 0!==arguments[1]?arguments[1]:"cache"]}},{key:"onchange",value:function(){}},{key:"remove",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e="string"!=typeof a?a.toString():a,f=void 0;if(this.has(e)){var g=this.cache[e];delete this.cache[e],this.length--,this.ttl>0&&this.clearTimer(e),this.has(g.previous)?(this.cache[g.previous].next=g.next,this.first===e&&(this.first=g.previous)):this.first===e&&(this.first=d),this.has(g.next)?(this.cache[g.next].previous=g.previous,this.last===e&&(this.last=g.next)):this.last===e&&(this.last=d),f=g}else this.first===e&&(this.first=d),this.last===e&&(this.last=d);return!b&&this.notify&&c(this.onchange("remove",this.dump())),f}},{key:"reset",value:function(){var a=this;return void 0!==this.timers&&Object.keys(this.timers).forEach(function(b){return a.clearTimer(b)}),this.cache={},this.expires={},this.first=d,this.last=d,this.length=0,this.timers={},this}},{key:"set",value:function(a,b){var e=void 0,f=void 0;return this.has(a)?(f=this.cache[a],f.value=b,f.next=d,this.first!==a&&(f.previous=this.first),this.last===a&&f.previous!==d&&(this.last=f.previous)):(++this.length>this.max&&this.remove(this.last,!0),1===this.length&&(this.last=a),this.cache[a]={next:d,previous:this.first,value:b}),this.first!==a&&this.has(this.first)&&(e=this.cache[this.first],e.next=a,e.previous===a&&(e.previous=d)),this.first=a,this.notify&&c(this.onchange("set",this.dump())),this.ttl>0&&this.clearTimer(a).setTimer(a),this.expire>0&&this.setExpire(a),this}},{key:"setExpire",value:function(a){var b=this;a in this.expires==!1&&(this.expires[a]=setTimeout(function(){delete b.expires[a],b.clearTimer(a).remove(a)},this.expire))}},{key:"setTimer",value:function(a){var b=this;this.timers[a]=setTimeout(function(){return b.remove(a)},this.ttl)}},{key:"update",value:function(a){var b=this,c=JSON.parse(a);Object.keys(c).forEach(function(a){b[a]=c[a]})}}]),LRU}();"undefined"!=typeof exports?module.exports=b:"function"==typeof define&&void 0!==define.amd?define(function(){return b}):a.lru=b}("undefined"!=typeof window?window:global);
//# sourceMappingURL=tiny-lru.min.js.map