/* 2018 Jason Mulligan <jason.mulligan@avoidwork.com> */

"use strict";var _createClass=function(){function s(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(t){var r="undefined"!=typeof process?process.nextTick:function(t){return setTimeout(t,1)},h="",LRU=function(){function LRU(t,e,i,s){return _classCallCheck(this,LRU),this.expire=s,this.max=t,this.notify=e,this.ttl=i,this.reset()}return _createClass(LRU,[{key:"clear",value:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return this.reset(),!t&&this.notify&&r(this.onchange("clear",this.dump())),this}},{key:"clearTimer",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"timers";return this.has(t,e)&&(clearTimeout(this[e][t]),delete this[e][t]),this}},{key:"delete",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return this.remove(t,e)}},{key:"dump",value:function(){var t=JSON.parse(JSON.stringify(this));return delete t.timers,JSON.stringify(t)}},{key:"evict",value:function(){return this.has(this.last)&&this.remove(this.last,!0),this.notify&&r(this.onchange("evict",this.dump())),this}},{key:"get",value:function(t){var e=void 0;return this.has(t)&&(e=this.cache[t].value,this.set(t,e),this.notify&&r(this.onchange("get",this.dump())),0<this.ttl&&this.clearTimer(t).setTimer(t)),e}},{key:"has",value:function(t){return t in this[1<arguments.length&&void 0!==arguments[1]?arguments[1]:"cache"]}},{key:"onchange",value:function(){}},{key:"remove",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=void 0;if(this.has(t)){var s=this.cache[t];delete this.cache[t],this.length--,0<this.ttl&&this.clearTimer(t),!1===e&&0<this.expire&&this.clearTimer(t,"expires"),this.has(s.previous)?(this.cache[s.previous].next=s.next,this.first===t&&(this.first=s.previous)):this.first===t&&(this.first=h),this.has(s.next)?(this.cache[s.next].previous=s.previous,this.last===t&&(this.last=s.next)):this.last===t&&(this.last=h),i=s}else this.first===t&&(this.first=h),this.last===t&&(this.last=h);return!e&&this.notify&&r(this.onchange("remove",this.dump())),i}},{key:"reset",value:function(){var e=this;return void 0!==this.expires&&Object.keys(this.expires).forEach(function(t){return e.clearTimer(t,"expires")}),void 0!==this.timers&&Object.keys(this.timers).forEach(function(t){return e.clearTimer(t)}),this.cache={},this.expires={},this.first=h,this.last=h,this.length=0,this.timers={},this}},{key:"set",value:function(t,e){var i=void 0,s=void 0;return this.has(t)?((s=this.cache[t]).value=e,s.next=h,this.first!==t&&(s.previous=this.first),this.last===t&&s.previous!==h&&(this.last=s.previous)):(++this.length>this.max&&this.remove(this.last,!0),1===this.length&&(this.last=t),this.cache[t]={next:h,previous:this.first,value:e}),this.first!==t&&this.has(this.first)&&((i=this.cache[this.first]).next=t,i.previous===t&&(i.previous=h)),this.first=t,this.notify&&r(this.onchange("set",this.dump())),0<this.ttl&&this.clearTimer(t).setTimer(t),0<this.expire&&!1===this.has(t,"expires")&&this.setExpire(t),this}},{key:"setExpire",value:function(t){var e=this;this.expires[t]=setTimeout(function(){return e.clearTimer(t,"expires").clearTimer(t).remove(t)},this.expire)}},{key:"setTimer",value:function(t){var e=this;this.timers[t]=setTimeout(function(){return e.remove(t)},this.ttl)}},{key:"update",value:function(t){var e=this,i=JSON.parse(t);Object.keys(i).forEach(function(t){e[t]=i[t]})}}]),LRU}();function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1e3,e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;return new LRU(t,e,i,s)}"undefined"!=typeof exports?module.exports=e:"function"==typeof define&&void 0!==define.amd?define(function(){return e}):t.lru=e}("undefined"!=typeof window?window:global);
//# sourceMappingURL=tiny-lru.min.js.map