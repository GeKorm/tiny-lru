{"version":3,"sources":["tiny-lru.js"],"names":["process","setTimeout","nextTick","constructor","max","notify","ttl","reset","clear","onchange","dump","delete","remove","JSON","stringify","cache","first","last","length","evict","get","has","expiry","Date","now","value","next","previous","set","getTime","update","parse","Object","keys","forEach","exports","define","amd","lru","module","window","global"],"mappings":"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","file":"unknown","sourcesContent":["/**\n * Tiny LRU cache for Client or Server\n *\n * @author Jason Mulligan <jason.mulligan@avoidwork.com>\n * @copyright 2018\n * @license BSD-3-Clause\n * @link https://github.com/avoidwork/tiny-lru\n * @version 3.0.0\n */\n\n\n(function (global) {\n\tconst next = typeof process !== \"undefined\" ? process.nextTick : arg => setTimeout(arg, 1),\n\t\tempty = null;\n\n\tclass LRU {\n\t\tconstructor (max, notify, ttl) {\n\t\t\tthis.max = max;\n\t\t\tthis.notify = notify;\n\t\t\tthis.ttl = ttl;\n\n\t\t\treturn this.reset();\n\t\t}\n\n\t\tclear (silent = false) {\n\t\t\tthis.reset();\n\n\t\t\tif (silent === false && this.notify === true) {\n\t\t\t\tnext(this.onchange(\"clear\", this.dump()));\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\tdelete (key, silent = false) {\n\t\t\treturn this.remove(key, silent);\n\t\t}\n\n\t\tdump () {\n\t\t\treturn JSON.stringify({\n\t\t\t\tcache: this.cache,\n\t\t\t\tfirst: this.first,\n\t\t\t\tlast: this.last,\n\t\t\t\tlength: this.length,\n\t\t\t\tmax: this.max,\n\t\t\t\tnotify: this.notify,\n\t\t\t\tttl: this.ttl\n\t\t\t});\n\t\t}\n\n\t\tevict () {\n\t\t\tthis.remove(this.last, true);\n\n\t\t\tif (this.notify === true) {\n\t\t\t\tnext(this.onchange(\"evict\", this.dump()));\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\tget (key) {\n\t\t\tlet output;\n\n\t\t\tif (this.has(key) === true) {\n\t\t\t\tconst item = this.cache[key];\n\n\t\t\t\tif (item.expiry === -1 || item.expiry <= Date.now()) {\n\t\t\t\t\toutput = item.value;\n\n\t\t\t\t\tif (this.first !== empty) {\n\t\t\t\t\t\tthis.cache[this.first].next = key;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.first = key;\n\n\t\t\t\t\tif (this.notify === true) {\n\t\t\t\t\t\tnext(this.onchange(\"get\", this.dump()));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.remove(key);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn output;\n\t\t}\n\n\t\thas (key) {\n\t\t\treturn key in this.cache;\n\t\t}\n\n\t\tonchange () {}\n\n\t\tremove (key, silent = false) {\n\t\t\tlet result;\n\n\t\t\tif (this.has(key) === true) {\n\t\t\t\tresult = this.cache[key];\n\n\t\t\t\tdelete this.cache[key];\n\t\t\t\tthis.length--;\n\n\t\t\t\tif (result.previous !== empty) {\n\t\t\t\t\tthis.cache[result.previous].next = result.next;\n\n\t\t\t\t\tif (this.first === key) {\n\t\t\t\t\t\tthis.first = result.previous;\n\t\t\t\t\t}\n\t\t\t\t} else if (this.first === key) {\n\t\t\t\t\tthis.first = empty;\n\t\t\t\t}\n\n\t\t\t\tif (result.next !== empty) {\n\t\t\t\t\tthis.cache[result.next].previous = result.previous;\n\n\t\t\t\t\tif (this.last === key) {\n\t\t\t\t\t\tthis.last = result.next;\n\t\t\t\t\t}\n\t\t\t\t} else if (this.last === key) {\n\t\t\t\t\tthis.last = empty;\n\t\t\t\t}\n\n\t\t\t\tif (silent === false && this.notify === true) {\n\t\t\t\t\tnext(this.onchange(\"remove\", this.dump()));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\treset () {\n\t\t\tthis.cache = {};\n\t\t\tthis.first = empty;\n\t\t\tthis.last = empty;\n\t\t\tthis.length = 0;\n\n\t\t\treturn this;\n\t\t}\n\n\t\tset (key, value) {\n\t\t\tif (this.has(key) === true) {\n\t\t\t\tconst item = this.cache[key];\n\n\t\t\t\titem.value = value;\n\t\t\t\titem.next = empty;\n\n\t\t\t\tif (this.first !== key) {\n\t\t\t\t\titem.previous = this.first;\n\t\t\t\t}\n\n\t\t\t\tif (this.last === key && item.previous !== empty) {\n\t\t\t\t\tthis.last = item.previous;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this.length === this.max) {\n\t\t\t\t\tthis.evict();\n\t\t\t\t}\n\n\t\t\t\tthis.length++;\n\t\t\t\tthis.cache[key] = {\n\t\t\t\t\texpiry: this.ttl > 0 ? new Date().getTime() + this.ttl : -1,\n\t\t\t\t\tnext: empty,\n\t\t\t\t\tprevious: this.first,\n\t\t\t\t\tvalue: value\n\t\t\t\t};\n\n\t\t\t\tif (this.length === 1) {\n\t\t\t\t\tthis.last = key;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.first !== empty && this.first !== key) {\n\t\t\t\tconst first = this.cache[this.first];\n\n\t\t\t\tfirst.next = key;\n\n\t\t\t\tif (first.previous === key) {\n\t\t\t\t\tfirst.previous = empty;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.first = key;\n\n\t\t\tif (this.notify === true) {\n\t\t\t\tnext(this.onchange(\"set\", this.dump()));\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\tupdate (arg) {\n\t\t\tconst obj = JSON.parse(arg);\n\n\t\t\tObject.keys(obj).forEach(i => {\n\t\t\t\tthis[i] = obj[i];\n\t\t\t});\n\t\t}\n\t}\n\n\tfunction factory (max = 1000, notify = false, ttl = 0, expire = 0) {\n\t\treturn new LRU(max, notify, ttl, expire);\n\t}\n\n\t// Node, AMD & window supported\n\tif (typeof exports !== \"undefined\") {\n\t\tmodule.exports = factory;\n\t} else if (typeof define === \"function\" && define.amd !== void 0) {\n\t\tdefine(() => factory);\n\t} else {\n\t\tglobal.lru = factory;\n\t}\n}(typeof window !== \"undefined\" ? window : global));\n"]}