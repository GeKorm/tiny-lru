{"version":3,"sources":["tiny-lru.js"],"names":["cache","first","last","length","constructor","max","ttl","call","clear","delete","remove","dump","JSON","stringify","notify","evict","get","has","expiry","Date","now","value","set","onchange","previous","next","getTime","exports","define","amd","lru","module","window","global"],"mappings":"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","file":"unknown","sourcesContent":["/**\r\n * Tiny LRU cache for Client or Server\r\n *\r\n * @author Jason Mulligan <jason.mulligan@avoidwork.com>\r\n * @copyright 2018\r\n * @license BSD-3-Clause\r\n * @link https://github.com/avoidwork/tiny-lru\r\n * @version 5.0.0\r\n */\r\n\r\n\r\n(function (global) {\r\n\tconst empty = null;\r\n\r\n\tfunction link (item, key, a, b) {\r\n\t\titem[a] = key;\r\n\r\n\t\tif (item[b] === key) {\r\n\t\t\titem[b] = empty;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction reset () {\r\n\t\tthis.cache = {};\r\n\t\tthis.first = empty;\r\n\t\tthis.last = empty;\r\n\t\tthis.length = 0;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tclass LRU {\r\n\t\tconstructor (max, ttl) {\r\n\t\t\tthis.max = max;\r\n\t\t\tthis.ttl = ttl;\r\n\t\t\treset.call(this);\r\n\t\t}\r\n\r\n\t\tclear () {\r\n\t\t\treset.call(this);\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tdelete (key) {\r\n\t\t\treturn this.remove(key);\r\n\t\t}\r\n\r\n\t\tdump () {\r\n\t\t\treturn JSON.stringify({\r\n\t\t\t\tcache: this.cache,\r\n\t\t\t\tfirst: this.first,\r\n\t\t\t\tlast: this.last,\r\n\t\t\t\tlength: this.length,\r\n\t\t\t\tmax: this.max,\r\n\t\t\t\tnotify: this.notify,\r\n\t\t\t\tttl: this.ttl\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tevict () {\r\n\t\t\tthis.remove(this.last, true);\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tget (key) {\r\n\t\t\tlet result;\r\n\r\n\t\t\tif (this.has(key) === true) {\r\n\t\t\t\tconst item = this.cache[key];\r\n\r\n\t\t\t\tif (item.expiry === -1 || item.expiry > Date.now()) {\r\n\t\t\t\t\tresult = item.value;\r\n\t\t\t\t\tthis.set(key, result, true, true);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.remove(key);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\thas (key) {\r\n\t\t\treturn key in this.cache;\r\n\t\t}\r\n\r\n\t\tonchange () {}\r\n\r\n\t\tremove (key, bypass = false) {\r\n\t\t\tlet result;\r\n\r\n\t\t\tif (bypass === true || this.has(key) === true) {\r\n\t\t\t\tresult = this.cache[key];\r\n\r\n\t\t\t\tdelete this.cache[key];\r\n\t\t\t\tthis.length--;\r\n\r\n\t\t\t\tif (result.previous !== empty) {\r\n\t\t\t\t\tthis.cache[result.previous].next = result.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (result.next !== empty) {\r\n\t\t\t\t\tthis.cache[result.next].previous = result.previous;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.first === key) {\r\n\t\t\t\t\tthis.first = result.previous;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.last === key) {\r\n\t\t\t\t\tthis.last = result.next;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tset (key, value, bypass = false) {\r\n\t\t\tif (bypass === true || this.has(key) === true) {\r\n\t\t\t\tconst item = this.cache[key];\r\n\r\n\t\t\t\titem.value = value;\r\n\r\n\t\t\t\tif (this.first !== key) {\r\n\t\t\t\t\tconst n = item.next,\r\n\t\t\t\t\t\tp = item.previous;\r\n\r\n\t\t\t\t\titem.next = empty;\r\n\t\t\t\t\titem.previous = this.first;\r\n\t\t\t\t\tlink(this.cache[this.first], key, \"next\", \"previous\");\r\n\r\n\t\t\t\t\tif (n !== empty && n !== this.first) {\r\n\t\t\t\t\t\tif (p !== empty) {\r\n\t\t\t\t\t\t\tthis.cache[p].next = n;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthis.cache[n].previous = p;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (this.last === key) {\r\n\t\t\t\t\t\tthis.last = n;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (this.length === this.max) {\r\n\t\t\t\t\tthis.evict();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.length++;\r\n\t\t\t\tthis.cache[key] = {\r\n\t\t\t\t\texpiry: this.ttl > 0 ? new Date().getTime() + this.ttl : -1,\r\n\t\t\t\t\tnext: empty,\r\n\t\t\t\t\tprevious: this.first,\r\n\t\t\t\t\tvalue: value\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (this.length === 1) {\r\n\t\t\t\t\tthis.last = key;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.first !== empty && this.first !== key) {\r\n\t\t\t\t\tlink(this.cache[this.first], key, \"next\", \"previous\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.first = key;\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction factory (max = 1000, ttl = 0) {\r\n\t\treturn new LRU(max, ttl);\r\n\t}\r\n\r\n\t// Node, AMD & window supported\r\n\tif (typeof exports !== \"undefined\") {\r\n\t\tmodule.exports = factory;\r\n\t} else if (typeof define === \"function\" && define.amd !== void 0) {\r\n\t\tdefine(() => factory);\r\n\t} else {\r\n\t\tglobal.lru = factory;\r\n\t}\r\n}(typeof window !== \"undefined\" ? window : global));\r\n"]}