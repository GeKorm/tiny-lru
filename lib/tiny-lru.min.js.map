{"version":3,"sources":["tiny-lru.js"],"names":["global","factory","max","ttl","LRU","empty","constructor","clear","cache","first","last","length","delete","key","bypass","has","item","next","prev","evict","get","result","expiry","Date","now","value","set","keys","Object","remove","p","n","f","getTime","exports","define","amd","lru","module","window"],"mappings":"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","file":"unknown","sourcesContent":["/**\r\n * Tiny LRU cache for Client or Server\r\n *\r\n * @author Jason Mulligan <jason.mulligan@avoidwork.com>\r\n * @copyright 2019\r\n * @license BSD-3-Clause\r\n * @version 5.1.4\r\n */\r\n\r\n\r\n(function (global) {\r\n\tconst empty = null;\r\n\r\n\tclass LRU {\r\n\t\tconstructor (max, ttl) {\r\n\t\t\tthis.clear();\r\n\t\t\tthis.max = max;\r\n\t\t\tthis.ttl = ttl;\r\n\t\t}\r\n\r\n\t\tclear () {\r\n\t\t\tthis.cache = {};\r\n\t\t\tthis.first = empty;\r\n\t\t\tthis.last = empty;\r\n\t\t\tthis.length = 0;\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tdelete (key, bypass = false) {\r\n\t\t\tif (bypass || this.has(key)) {\r\n\t\t\t\tconst item = this.cache[key];\r\n\r\n\t\t\t\tdelete this.cache[key];\r\n\t\t\t\tthis.length--;\r\n\r\n\t\t\t\tif (item.next !== empty) {\r\n\t\t\t\t\tthis.cache[item.next].prev = item.prev;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (item.prev !== empty) {\r\n\t\t\t\t\tthis.cache[item.prev].next = item.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.first === key) {\r\n\t\t\t\t\tthis.first = item.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.last === key) {\r\n\t\t\t\t\tthis.last = item.prev;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tevict () {\r\n\t\t\tif (this.length > 0) {\r\n\t\t\t\tthis.delete(this.last, true);\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tget (key) {\r\n\t\t\tlet result;\r\n\r\n\t\t\tif (this.has(key)) {\r\n\t\t\t\tconst item = this.cache[key];\r\n\r\n\t\t\t\tif (item.expiry === -1 || item.expiry > Date.now()) {\r\n\t\t\t\t\tresult = item.value;\r\n\t\t\t\t\tthis.set(key, result, true);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.delete(key, true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\thas (key) {\r\n\t\t\treturn key in this.cache;\r\n\t\t}\r\n\r\n\t\tkeys () {\r\n\t\t\treturn Object.keys(this.cache);\r\n\t\t}\r\n\r\n\t\tremove (key, bypass = false) {\r\n\t\t\treturn this.delete(key, bypass);\r\n\t\t}\r\n\r\n\t\tset (key, value, bypass = false) {\r\n\t\t\tif (bypass || this.has(key)) {\r\n\t\t\t\tconst item = this.cache[key];\r\n\r\n\t\t\t\titem.value = value;\r\n\r\n\t\t\t\tif (this.first !== key) {\r\n\t\t\t\t\tconst p = item.prev,\r\n\t\t\t\t\t\tn = item.next,\r\n\t\t\t\t\t\tf = this.cache[this.first];\r\n\r\n\t\t\t\t\titem.prev = empty;\r\n\t\t\t\t\titem.next = this.first;\r\n\t\t\t\t\tf.prev = key;\r\n\r\n\t\t\t\t\tif (p !== empty) {\r\n\t\t\t\t\t\tthis.cache[p].next = n;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (n !== empty) {\r\n\t\t\t\t\t\tthis.cache[n].prev = p;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (this.last === key) {\r\n\t\t\t\t\t\tthis.last = p;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (this.length === this.max) {\r\n\t\t\t\t\tthis.evict();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.length++;\r\n\t\t\t\tthis.cache[key] = {\r\n\t\t\t\t\texpiry: this.ttl > 0 ? new Date().getTime() + this.ttl : -1,\r\n\t\t\t\t\tprev: empty,\r\n\t\t\t\t\tnext: this.first,\r\n\t\t\t\t\tvalue: value\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (this.length === 1) {\r\n\t\t\t\t\tthis.last = key;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.cache[this.first].prev = key;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.first = key;\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction factory (max = 1000, ttl = 0) {\r\n\t\treturn new LRU(max, ttl);\r\n\t}\r\n\r\n\t// Node, AMD & window supported\r\n\tif (typeof exports !== \"undefined\") {\r\n\t\tmodule.exports = factory;\r\n\t} else if (typeof define === \"function\" && define.amd !== void 0) {\r\n\t\tdefine(() => factory);\r\n\t} else {\r\n\t\tglobal.lru = factory;\r\n\t}\r\n}(typeof window !== \"undefined\" ? window : global));\r\n"]}