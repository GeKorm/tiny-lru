{"version":3,"sources":["tiny-lru.js"],"names":["process","setTimeout","nextTick","constructor","expire","max","notify","ttl","reset","clear","onchange","dump","clearTimer","has","clearTimeout","delete","remove","JSON","stringify","cache","first","last","length","evict","get","value","link","setTimer","next","previous","expires","Object","keys","forEach","timers","set","setExpire","update","parse","exports","define","amd","lru","module","window","global"],"mappings":"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","file":"unknown","sourcesContent":["/**\n * Tiny LRU cache for Client or Server\n *\n * @author Jason Mulligan <jason.mulligan@avoidwork.com>\n * @copyright 2018\n * @license BSD-3-Clause\n * @link https://github.com/avoidwork/tiny-lru\n * @version 2.0.1\n */\n\n\n(function (global) {\n\tconst next = typeof process !== \"undefined\" ? process.nextTick : arg => setTimeout(arg, 1),\n\t\tempty = \"\";\n\n\tclass LRU {\n\t\tconstructor (max, notify, ttl, expire) {\n\t\t\tthis.expire = expire;\n\t\t\tthis.max = max;\n\t\t\tthis.notify = notify;\n\t\t\tthis.ttl = ttl;\n\n\t\t\treturn this.reset();\n\t\t}\n\n\t\tclear (silent = false) {\n\t\t\tthis.reset();\n\n\t\t\tif (silent === false && this.notify === true) {\n\t\t\t\tnext(this.onchange(\"clear\", this.dump()));\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\tclearTimer (key, col = \"timers\") {\n\t\t\tif (this.has(key, col) === true) {\n\t\t\t\tclearTimeout(this[col][key]);\n\t\t\t\tdelete this[col][key];\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\tdelete (key, silent = false) {\n\t\t\treturn this.remove(key, silent);\n\t\t}\n\n\t\tdump () {\n\t\t\treturn JSON.stringify({\n\t\t\t\tcache: this.cache,\n\t\t\t\texpire: this.expire,\n\t\t\t\tfirst: this.first,\n\t\t\t\tlast: this.last,\n\t\t\t\tlength: this.length,\n\t\t\t\tmax: this.max,\n\t\t\t\tnotify: this.notify,\n\t\t\t\tttl: this.ttl\n\t\t\t});\n\t\t}\n\n\t\tevict () {\n\t\t\tthis.remove(this.last, true);\n\n\t\t\tif (this.notify === true) {\n\t\t\t\tnext(this.onchange(\"evict\", this.dump()));\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\tget (key) {\n\t\t\tlet output;\n\n\t\t\tif (this.has(key) === true) {\n\t\t\t\toutput = this.cache[key].value;\n\t\t\t\tthis.link(key, \"first\");\n\t\t\t\t//this.set(key, output);\n\n\t\t\t\tif (this.ttl > 0) {\n\t\t\t\t\tthis.clearTimer(key).setTimer(key);\n\t\t\t\t}\n\n\t\t\t\tif (this.notify === true) {\n\t\t\t\t\tnext(this.onchange(\"get\", this.dump()));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn output;\n\t\t}\n\n\t\thas (key, type = \"cache\") {\n\t\t\treturn key in this[type];\n\t\t}\n\n\t\tlink (key, pos = \"first\") {\n\t\t\tif (this[pos] !== key) {\n\t\t\t\tif (pos === \"first\") {\n\t\t\t\t\tconst item = this.cache[key];\n\n\t\t\t\t\titem.next = empty;\n\n\t\t\t\t\tif (this.last === key && item.previous !== empty) {\n\t\t\t\t\t\tthis.last = item.previous;\n\t\t\t\t\t}\n\n\t\t\t\t\titem.previous = this.first;\n\t\t\t\t\tthis.first = key;\n\t\t\t\t}/* else {\n\n\t\t\t\t}*/\n\t\t\t}\n\t\t}\n\n\t\tonchange () {}\n\n\t\tremove (key, silent = false) {\n\t\t\tlet result;\n\n\t\t\tif (this.has(key) === true) {\n\t\t\t\tconst cached = this.cache[key];\n\n\t\t\t\tdelete this.cache[key];\n\t\t\t\tthis.length--;\n\n\t\t\t\tif (this.ttl > 0) {\n\t\t\t\t\tthis.clearTimer(key);\n\t\t\t\t}\n\n\t\t\t\tif (this.expire > 0) {\n\t\t\t\t\tthis.clearTimer(key, \"expires\");\n\t\t\t\t}\n\n\t\t\t\tif (this.has(cached.previous) === true) {\n\t\t\t\t\tthis.cache[cached.previous].next = cached.next;\n\n\t\t\t\t\tif (this.first === key) {\n\t\t\t\t\t\tthis.first = cached.previous;\n\t\t\t\t\t}\n\t\t\t\t} else if (this.first === key) {\n\t\t\t\t\tthis.first = empty;\n\t\t\t\t}\n\n\t\t\t\tif (this.has(cached.next) === true) {\n\t\t\t\t\tthis.cache[cached.next].previous = cached.previous;\n\n\t\t\t\t\tif (this.last === key) {\n\t\t\t\t\t\tthis.last = cached.next;\n\t\t\t\t\t}\n\t\t\t\t} else if (this.last === key) {\n\t\t\t\t\tthis.last = empty;\n\t\t\t\t}\n\n\t\t\t\tresult = cached;\n\n\t\t\t\tif (silent === false && this.notify === true) {\n\t\t\t\t\tnext(this.onchange(\"remove\", this.dump()));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\treset () {\n\t\t\tif (this.expires !== void 0) {\n\t\t\t\tObject.keys(this.expires).forEach(i => this.clearTimer(i, \"expires\"));\n\t\t\t}\n\n\t\t\tif (this.timers !== void 0) {\n\t\t\t\tObject.keys(this.timers).forEach(i => this.clearTimer(i));\n\t\t\t}\n\n\t\t\tthis.cache = {};\n\t\t\tthis.expires = {};\n\t\t\tthis.first = empty;\n\t\t\tthis.last = empty;\n\t\t\tthis.length = 0;\n\t\t\tthis.timers = {};\n\n\t\t\treturn this;\n\t\t}\n\n\t\tset (key, value) {\n\t\t\tlet first, item;\n\n\t\t\tif (this.has(key) === true) {\n\t\t\t\titem = this.cache[key];\n\t\t\t\titem.value = value;\n\t\t\t\titem.next = empty;\n\n\t\t\t\tif (this.first !== key) {\n\t\t\t\t\titem.previous = this.first;\n\t\t\t\t}\n\n\t\t\t\tif (this.last === key && item.previous !== empty) {\n\t\t\t\t\tthis.last = item.previous;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this.length === this.max) {\n\t\t\t\t\tthis.evict();\n\t\t\t\t}\n\n\t\t\t\tthis.length++;\n\n\t\t\t\tif (this.length === 1) {\n\t\t\t\t\tthis.last = key;\n\t\t\t\t}\n\n\t\t\t\tthis.cache[key] = {\n\t\t\t\t\tnext: empty,\n\t\t\t\t\tprevious: this.first,\n\t\t\t\t\tvalue: value\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (this.first !== key && this.has(this.first) === true) {\n\t\t\t\tfirst = this.cache[this.first];\n\t\t\t\tfirst.next = key;\n\n\t\t\t\tif (first.previous === key) {\n\t\t\t\t\tfirst.previous = empty;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.first = key;\n\n\t\t\tif (this.notify === true) {\n\t\t\t\tnext(this.onchange(\"set\", this.dump()));\n\t\t\t}\n\n\t\t\tif (this.ttl > 0) {\n\t\t\t\tthis.clearTimer(key).setTimer(key);\n\t\t\t}\n\n\t\t\tif (this.expire > 0 && this.has(key, \"expires\") === false) {\n\t\t\t\tthis.setExpire(key);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\tsetExpire (key) {\n\t\t\tthis.expires[key] = setTimeout(() => this.clearTimer(key, \"expires\").clearTimer(key).remove(key), this.expire);\n\t\t}\n\n\t\tsetTimer (key) {\n\t\t\tthis.timers[key] = setTimeout(() => this.remove(key), this.ttl);\n\t\t}\n\n\t\tupdate (arg) {\n\t\t\tconst obj = JSON.parse(arg);\n\n\t\t\tObject.keys(obj).forEach(i => {\n\t\t\t\tthis[i] = obj[i];\n\t\t\t});\n\t\t}\n\t}\n\n\tfunction factory (max = 1000, notify = false, ttl = 0, expire = 0) {\n\t\treturn new LRU(max, notify, ttl, expire);\n\t}\n\n\t// Node, AMD & window supported\n\tif (typeof exports !== \"undefined\") {\n\t\tmodule.exports = factory;\n\t} else if (typeof define === \"function\" && define.amd !== void 0) {\n\t\tdefine(() => factory);\n\t} else {\n\t\tglobal.lru = factory;\n\t}\n}(typeof window !== \"undefined\" ? window : global));\n"]}