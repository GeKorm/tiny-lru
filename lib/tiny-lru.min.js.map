{"version":3,"sources":["tiny-lru.js"],"names":["cache","first","last","length","process","setTimeout","nextTick","constructor","max","notify","ttl","call","clear","onchange","dump","delete","remove","JSON","stringify","evict","get","has","expiry","Date","now","value","set","previous","next","getTime","update","parse","Object","keys","forEach","exports","define","amd","lru","module","window","global"],"mappings":"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","file":"unknown","sourcesContent":["/**\r\n * Tiny LRU cache for Client or Server\r\n *\r\n * @author Jason Mulligan <jason.mulligan@avoidwork.com>\r\n * @copyright 2018\r\n * @license BSD-3-Clause\r\n * @link https://github.com/avoidwork/tiny-lru\r\n * @version 4.0.0\r\n */\r\n\r\n\r\n(function (global) {\r\n\tconst next = typeof process !== \"undefined\" ? process.nextTick : arg => setTimeout(arg, 1),\r\n\t\tempty = null;\r\n\r\n\tfunction reset () {\r\n\t\tthis.cache = {};\r\n\t\tthis.first = empty;\r\n\t\tthis.last = empty;\r\n\t\tthis.length = 0;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tclass LRU {\r\n\t\tconstructor (max, notify, ttl) {\r\n\t\t\tthis.max = max;\r\n\t\t\tthis.notify = notify;\r\n\t\t\tthis.ttl = ttl;\r\n\t\t\treset.call(this);\r\n\t\t}\r\n\r\n\t\tclear (silent = false) {\r\n\t\t\treset.call(this);\r\n\r\n\t\t\tif (silent === false && this.notify === true) {\r\n\t\t\t\tnext(this.onchange(\"clear\", this.dump()));\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tdelete (key, silent = false) {\r\n\t\t\treturn this.remove(key, silent);\r\n\t\t}\r\n\r\n\t\tdump () {\r\n\t\t\treturn JSON.stringify({\r\n\t\t\t\tcache: this.cache,\r\n\t\t\t\tfirst: this.first,\r\n\t\t\t\tlast: this.last,\r\n\t\t\t\tlength: this.length,\r\n\t\t\t\tmax: this.max,\r\n\t\t\t\tnotify: this.notify,\r\n\t\t\t\tttl: this.ttl\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tevict () {\r\n\t\t\tthis.remove(this.last, true, true);\r\n\r\n\t\t\tif (this.notify === true) {\r\n\t\t\t\tnext(this.onchange(\"evict\", this.dump()));\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tget (key, silent = false) {\r\n\t\t\tlet result;\r\n\r\n\t\t\tif (this.has(key) === true) {\r\n\t\t\t\tconst item = this.cache[key];\r\n\r\n\t\t\t\tif (item.expiry === -1 || item.expiry > Date.now()) {\r\n\t\t\t\t\tresult = item.value;\r\n\t\t\t\t\tthis.set(key, result, true, true);\r\n\r\n\t\t\t\t\tif (silent === false && this.notify === true) {\r\n\t\t\t\t\t\tnext(this.onchange(\"get\", this.dump()));\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.remove(key);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\thas (key) {\r\n\t\t\treturn key in this.cache;\r\n\t\t}\r\n\r\n\t\tonchange () {}\r\n\r\n\t\tremove (key, silent = false, bypass = false) {\r\n\t\t\tlet result;\r\n\r\n\t\t\tif (bypass === true || this.has(key) === true) {\r\n\t\t\t\tresult = this.cache[key];\r\n\r\n\t\t\t\tdelete this.cache[key];\r\n\t\t\t\tthis.length--;\r\n\r\n\t\t\t\tif (result.previous !== empty) {\r\n\t\t\t\t\tthis.cache[result.previous].next = result.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (result.next !== empty) {\r\n\t\t\t\t\tthis.cache[result.next].previous = result.previous;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.first === key) {\r\n\t\t\t\t\tthis.first = result.previous;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.last === key) {\r\n\t\t\t\t\tthis.last = this.first;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (silent === false && this.notify === true) {\r\n\t\t\t\t\tnext(this.onchange(\"remove\", this.dump()));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tset (key, value, silent = false, bypass = false) {\r\n\t\t\tif (bypass === true || this.has(key) === true) {\r\n\t\t\t\tconst item = this.cache[key];\r\n\r\n\t\t\t\titem.value = value;\r\n\t\t\t\titem.next = empty;\r\n\r\n\t\t\t\tif (this.first !== key) {\r\n\t\t\t\t\titem.previous = this.first;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.last === key && item.previous !== empty) {\r\n\t\t\t\t\tthis.last = item.previous;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (this.length === this.max) {\r\n\t\t\t\t\tthis.evict();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.length++;\r\n\t\t\t\tthis.cache[key] = {\r\n\t\t\t\t\texpiry: this.ttl > 0 ? new Date().getTime() + this.ttl : -1,\r\n\t\t\t\t\tnext: empty,\r\n\t\t\t\t\tprevious: this.first,\r\n\t\t\t\t\tvalue: value\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (this.length === 1) {\r\n\t\t\t\t\tthis.last = key;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.first !== empty && this.first !== key) {\r\n\t\t\t\tconst first = this.cache[this.first];\r\n\r\n\t\t\t\tfirst.next = key;\r\n\r\n\t\t\t\tif (first.previous === key) {\r\n\t\t\t\t\tfirst.previous = empty;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.first = key;\r\n\r\n\t\t\tif (silent === false && this.notify === true) {\r\n\t\t\t\tnext(this.onchange(\"set\", this.dump()));\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tupdate (arg) {\r\n\t\t\tconst obj = JSON.parse(arg);\r\n\r\n\t\t\tObject.keys(obj).forEach(i => {\r\n\t\t\t\tthis[i] = obj[i];\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tfunction factory (max = 1000, notify = false, ttl = 0) {\r\n\t\treturn new LRU(max, notify, ttl);\r\n\t}\r\n\r\n\t// Node, AMD & window supported\r\n\tif (typeof exports !== \"undefined\") {\r\n\t\tmodule.exports = factory;\r\n\t} else if (typeof define === \"function\" && define.amd !== void 0) {\r\n\t\tdefine(() => factory);\r\n\t} else {\r\n\t\tglobal.lru = factory;\r\n\t}\r\n}(typeof window !== \"undefined\" ? window : global));\r\n"]}