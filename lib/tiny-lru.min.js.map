{"version":3,"sources":["tiny-lru.js"],"names":["constructor","expiry","prev","next","value","clear","max","ttl","cache","first","last","length","delete","remove","evict","get","has","Date","now","set","getTime","exports","define","amd","lru","module","window","global"],"mappings":"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","file":"unknown","sourcesContent":["/**\r\n * Tiny LRU cache for Client or Server\r\n *\r\n * @author Jason Mulligan <jason.mulligan@avoidwork.com>\r\n * @copyright 2018\r\n * @license BSD-3-Clause\r\n * @link https://github.com/avoidwork/tiny-lru\r\n * @version 5.0.4\r\n */\r\n\r\n\r\n(function (global) {\r\n\tconst empty = null;\r\n\r\n\tclass LRUNode {\r\n\t\tconstructor (arg, expiry = -1, prev = null, next = null) {\r\n\t\t\tthis.expiry = expiry;\r\n\t\t\tthis.prev = prev;\r\n\t\t\tthis.next = next;\r\n\t\t\tthis.value = arg;\r\n\t\t}\r\n\t}\r\n\r\n\tclass LRU {\r\n\t\tconstructor (max, ttl) {\r\n\t\t\tthis.clear();\r\n\t\t\tthis.max = max;\r\n\t\t\tthis.ttl = ttl;\r\n\t\t}\r\n\r\n\t\tclear () {\r\n\t\t\tthis.cache = {};\r\n\t\t\tthis.first = empty;\r\n\t\t\tthis.last = empty;\r\n\t\t\tthis.length = 0;\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tdelete (key, bypass = false) {\r\n\t\t\treturn this.remove(key, bypass);\r\n\t\t}\r\n\r\n\t\tevict () {\r\n\t\t\tif (this.length > 0) {\r\n\t\t\t\tthis.remove(this.last, true);\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tget (key) {\r\n\t\t\tlet result;\r\n\r\n\t\t\tif (this.has(key) === true) {\r\n\t\t\t\tconst item = this.cache[key];\r\n\r\n\t\t\t\tif (item.expiry === -1 || item.expiry > Date.now()) {\r\n\t\t\t\t\tresult = item.value;\r\n\t\t\t\t\tthis.set(key, result, true);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.remove(key, true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\thas (key) {\r\n\t\t\treturn key in this.cache;\r\n\t\t}\r\n\r\n\t\tremove (key, bypass = false) {\r\n\t\t\tif (bypass === true || this.has(key) === true) {\r\n\t\t\t\tconst item = this.cache[key];\r\n\r\n\t\t\t\tdelete this.cache[key];\r\n\t\t\t\tthis.length--;\r\n\r\n\t\t\t\tif (item.next !== empty) {\r\n\t\t\t\t\tthis.cache[item.next].prev = item.prev;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (item.prev !== empty) {\r\n\t\t\t\t\tthis.cache[item.prev].next = item.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.first === key) {\r\n\t\t\t\t\tthis.first = item.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.last === key) {\r\n\t\t\t\t\tthis.last = item.prev;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tset (key, value, bypass = false) {\r\n\t\t\tif (bypass === true || this.has(key) === true) {\r\n\t\t\t\tconst item = this.cache[key];\r\n\r\n\t\t\t\titem.value = value;\r\n\r\n\t\t\t\tif (this.first !== key) {\r\n\t\t\t\t\tconst p = item.prev,\r\n\t\t\t\t\t\tn = item.next,\r\n\t\t\t\t\t\tf = this.cache[this.first];\r\n\r\n\t\t\t\t\titem.prev = empty;\r\n\t\t\t\t\titem.next = this.first;\r\n\t\t\t\t\tf.prev = key;\r\n\r\n\t\t\t\t\tif (p !== empty) {\r\n\t\t\t\t\t\tthis.cache[p].next = n;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (n !== empty) {\r\n\t\t\t\t\t\tthis.cache[n].prev = p;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (this.last === key) {\r\n\t\t\t\t\t\tthis.last = p;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (this.length === this.max) {\r\n\t\t\t\t\tthis.evict();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.length++;\r\n\t\t\t\tthis.cache[key] = new LRUNode(value, this.ttl > 0 ? new Date().getTime() + this.ttl : -1, empty, this.first);\r\n\r\n\t\t\t\tif (this.length === 1) {\r\n\t\t\t\t\tthis.last = key;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.cache[this.first].prev = key;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.first = key;\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction factory (max = 1000, ttl = 0) {\r\n\t\treturn new LRU(max, ttl);\r\n\t}\r\n\r\n\t// Node, AMD & window supported\r\n\tif (typeof exports !== \"undefined\") {\r\n\t\tmodule.exports = factory;\r\n\t} else if (typeof define === \"function\" && define.amd !== void 0) {\r\n\t\tdefine(() => factory);\r\n\t} else {\r\n\t\tglobal.lru = factory;\r\n\t}\r\n}(typeof window !== \"undefined\" ? window : global));\r\n"]}